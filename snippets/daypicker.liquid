<select id="delivery-picker">
	<option>Choisir son jour de livraison</option>
</select>

<script>
  $(document).ready(function() {
    $(window).unload(saveSettings);
    loadSettings();
  });

  function loadSettings() {
    if (localStorage.deliveryPicker === undefined) {
    	$('#delivery-picker').val($("#delivery-picker option:first").val());
    }
    else {
  	$('#delivery-picker').val(localStorage.deliveryPicker);
    }
  }

  function saveSettings() {
    localStorage.deliveryPicker = $('#delivery-picker').val();
  }

  function toTitleCase(str)
  {
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
  }

  var delay = 2;
  var curr = new Date;
  var first = curr.getDate() + delay;
  var firstday = (new Date(curr.setDate(first))).toString();
  var options = "";
  var arguments = {weekday: "long", year: "numeric", month: "long", day: "numeric"};
  var blacklisted_days = ["samedi", "dimanche"];
  for (var i = 0; i < 7; i++) {
  	var next = new Date(curr.getTime());
    next.setDate(first + i);
    if (blacklisted_days.includes(next.toLocaleDateString("fr-FR", { weekday: 'long' }))) {
    }
    else {
    	options += '<option>' + toTitleCase(next.toLocaleDateString("fr-FR", arguments)) + '</option>';
    }
  };
  $("#delivery-picker").append(options);
  $("#delivery-picker").change(function() {
    var response = $.getJSON('/cart.js').done(function(){
       var parsing = JSON.parse(response.responseText);
       var cartAttributes = parsing.attributes;
       var dayChosen = $("#delivery-picker").val();
       $.post('/cart/update.js', { attributes: { dayChosen } });
    });
    var dayChosen = $("#delivery-picker").val();
    var words = dayChosen.split(" ");
    var firstWord = words[0].toLowerCase();
    var productIds = [];
    {% assign str = "" %}
    {% for item in cart.items %}
      productIds.push("{{ item.product.metafields.global['availability'] }}");
      productIds.push({{ item.id }});
    {% endfor %}
    var productIdsLenght = productIds.length;
    for (var i = 0; i < productIdsLenght; i = i + 2) {
      var test = (productIds[i].toString().indexOf(firstWord) !== -1);
      if (test) {
      }
      else {
        $.post('/cart/change.js', { quantity: 0, id: productIds[i + 1] });
      }
    }
    location.reload(true);
  });
</script>
